<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse" style="background-color: #2c5530; min-height: 100vh;">
      <div class="position-sticky pt-3">
        <div class="text-center mb-4">
          <h5 class="text-white">
            <i class="fas fa-futbol me-2"></i>Soccer Academy
          </h5>
        </div>

        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link text-white" [routerLink]="['/dashboard']">
              <i class="fas fa-tachometer-alt me-2"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" [routerLink]="['/users']">
              <i class="fas fa-users me-2"></i>User Management
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" [routerLink]="['/players']">
              <i class="fas fa-user-graduate me-2"></i>Players
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" [routerLink]="['/teams']">
              <i class="fas fa-users-cog me-2"></i>Teams
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" [routerLink]="['/valuations']">
              <i class="fas fa-chart-line me-2"></i>Player Valuation
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" [routerLink]="['/training-sessions']">
              <i class="fas fa-dumbbell me-2"></i>Training Sessions
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white active" [routerLink]="['/fields']" 
               style="background-color: #5cb85c; border-radius: 0.375rem;">
              <i class="fas fa-map-marked-alt me-2"></i>Field Management
            </a>
          </li>
        </ul>

        <hr class="text-white">

        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link text-white" href="#" (click)="logout()">
              <i class="fas fa-sign-out-alt me-2"></i>Logout
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <!-- Header -->
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">
          <i class="fas fa-map-marked-alt me-2 text-success"></i>
          Field Management
        </h1>
        <div class="btn-toolbar">
          <!-- View Mode Toggle -->
          <div class="btn-group me-2" role="group">
            <button 
              type="button" 
              [class]="'btn btn-outline-secondary' + (viewMode === 'cards' ? ' active' : '')"
              (click)="viewMode = 'cards'">
              <i class="fas fa-th"></i>
            </button>
            <button 
              type="button" 
              [class]="'btn btn-outline-secondary' + (viewMode === 'list' ? ' active' : '')"
              (click)="viewMode = 'list'">
              <i class="fas fa-list"></i>
            </button>
            <button 
              type="button" 
              [class]="'btn btn-outline-secondary' + (viewMode === 'grid' ? ' active' : '')"
              (click)="viewMode = 'grid'">
              <i class="fas fa-th-large"></i>
            </button>
          </div>
          
          <!-- Add Field Button -->
          <button type="button" class="btn btn-success" (click)="openAddFieldModal()">
            <i class="fas fa-plus me-2"></i>Add Field
          </button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="row mb-4" *ngIf="stats">
        <div class="col-md-2">
          <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
              <div class="h3 text-primary mb-0">{{ stats.total_fields }}</div>
              <small class="text-muted">Total Fields</small>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
              <div class="h3 text-success mb-0">{{ stats.active_fields }}</div>
              <small class="text-muted">Active</small>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
              <div class="h3 text-info mb-0">{{ stats.indoor_fields }}</div>
              <small class="text-muted">Indoor</small>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
              <div class="h3 text-warning mb-0">{{ stats.outdoor_fields }}</div>
              <small class="text-muted">Outdoor</small>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
              <div class="h3 text-secondary mb-0">{{ stats.total_capacity }}</div>
              <small class="text-muted">Total Capacity</small>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card border-0 shadow-sm text-center">
            <div class="card-body">
              <div class="h3 text-danger mb-0">{{ stats.fields_in_use || 0 }}</div>
              <small class="text-muted">In Use</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Search and Filter Section -->
 <!-- Enhanced Search and Filter Section -->
<div class="card border-0 shadow-sm mb-4">
  <div class="card-header bg-light">
    <div class="d-flex justify-content-between align-items-center">
      <h6 class="mb-0">
        <i class="fas fa-filter me-2"></i>Search & Filter Fields
      </h6>
      <div class="btn-group btn-group-sm">
        <button 
          type="button" 
          class="btn btn-outline-secondary"
          (click)="toggleAdvancedFilters()"
        >
          <i class="fas fa-cog me-1"></i>
          {{ showAdvancedFilters ? 'Hide' : 'Show' }} Advanced
        </button>
        <button 
          type="button" 
          class="btn btn-outline-danger"
          (click)="clearAllFilters()"
          [disabled]="!hasActiveFilters()"
        >
          <i class="fas fa-times me-1"></i>Clear All
        </button>
      </div>
    </div>
  </div>
  
  <div class="card-body">
    <!-- Basic Search Row -->
    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <label for="searchInput" class="form-label">Search Fields</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="fas fa-search"></i>
          </span>
          <input 
            type="text" 
            class="form-control" 
            id="searchInput"
            placeholder="Search by name, location, facilities..."
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
          >
          <button 
            *ngIf="searchTerm" 
            class="btn btn-outline-secondary" 
            type="button"
            (click)="clearSearch()"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <div class="col-md-2">
        <label for="fieldTypeFilter" class="form-label">Field Type</label>
        <select class="form-select" id="fieldTypeFilter" [(ngModel)]="selectedFieldType" (change)="onFilterChange()">
          <option value="">All Types</option>
          <option *ngFor="let type of fieldTypes" [value]="type.value">
            {{ type.label }}
          </option>
        </select>
      </div>
      
      <div class="col-md-2">
        <label for="surfaceFilter" class="form-label">Surface</label>
        <select class="form-select" id="surfaceFilter" [(ngModel)]="selectedSurfaceType" (change)="onFilterChange()">
          <option value="">All Surfaces</option>
          <option *ngFor="let surface of surfaceTypes" [value]="surface.value">
            {{ surface.label }}
          </option>
        </select>
      </div>
      
      <div class="col-md-2">
        <label for="locationFilter" class="form-label">Location</label>
        <select class="form-select" id="locationFilter" [(ngModel)]="selectedLocation" (change)="onFilterChange()">
          <option value="">All Locations</option>
          <option *ngFor="let location of availableLocations" [value]="location">
            {{ location }}
          </option>
        </select>
      </div>
<!--       
      <div class="col-md-2">
        <label for="statusFilter" class="form-label">Status</label>
        <select class="form-select" id="statusFilter" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
          <option value="">All Status</option>
          <option value="available">Available</option>
          <option value="occupied">Occupied</option>
          <option value="maintenance">Maintenance</option>
        </select>
      </div> -->
    </div>

    <!-- Advanced Filters -->
    <div *ngIf="showAdvancedFilters" class="advanced-filters">
      <hr class="my-3">
      <div class="row g-3">
        <!-- Features Filters -->
        <div class="col-md-6">
          <label class="form-label">Features</label>
          <div class="row">
            <div class="col-6">
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="filterIndoor"
                  [(ngModel)]="filterIndoor"
                  (change)="onFilterChange()"
                >
                <label class="form-check-label" for="filterIndoor">
                  <i class="fas fa-home me-1"></i>Indoor Only
                </label>
              </div>
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="filterLighting"
                  [(ngModel)]="filterLighting"
                  (change)="onFilterChange()"
                >
                <label class="form-check-label" for="filterLighting">
                  <i class="fas fa-lightbulb me-1"></i>Has Lighting
                </label>
              </div>
            </div>
            <div class="col-6">
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="filterParking"
                  [(ngModel)]="filterParking"
                  (change)="onFilterChange()"
                >
                <label class="form-check-label" for="filterParking">
                  <i class="fas fa-parking me-1"></i>Has Parking
                </label>
              </div>
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="filterChangingRooms"
                  [(ngModel)]="filterChangingRooms"
                  (change)="onFilterChange()"
                >
                <label class="form-check-label" for="filterChangingRooms">
                  <i class="fas fa-door-open me-1"></i>Changing Rooms
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Capacity Range -->
        <div class="col-md-3">
          <label class="form-label">Capacity Range</label>
          <div class="row g-1">
            <div class="col-6">
              <input 
                type="number" 
                class="form-control form-control-sm" 
                placeholder="Min"
                [(ngModel)]="minCapacity"
                (input)="onFilterChange()"
                min="1"
              >
            </div>
            <div class="col-6">
              <input 
                type="number" 
                class="form-control form-control-sm" 
                placeholder="Max"
                [(ngModel)]="maxCapacity"
                (input)="onFilterChange()"
                min="1"
              >
            </div>
          </div>
        </div>

        <!-- Rate Range -->
        <div class="col-md-3">
          <label class="form-label">Hourly Rate Range ($)</label>
          <div class="row g-1">
            <div class="col-6">
              <input 
                type="number" 
                class="form-control form-control-sm" 
                placeholder="Min"
                [(ngModel)]="minRate"
                (input)="onFilterChange()"
                min="0"
                step="0.01"
              >
            </div>
            <div class="col-6">
              <input 
                type="number" 
                class="form-control form-control-sm" 
                placeholder="Max"
                [(ngModel)]="maxRate"
                (input)="onFilterChange()"
                min="0"
                step="0.01"
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Active Filters Display -->
    <div *ngIf="hasActiveFilters()" class="mt-3">
      <div class="d-flex flex-wrap align-items-center">
        <span class="badge bg-light text-dark me-2">Active Filters:</span>
        
        <span *ngIf="searchTerm" class="badge bg-primary me-1 mb-1">
          <i class="fas fa-search me-1"></i>{{ searchTerm }}
          <button type="button" class="btn-close btn-close-white ms-1" style="font-size: 0.6rem;" (click)="clearSearch()"></button>
        </span>
        
        <span *ngIf="selectedFieldType" class="badge bg-info me-1 mb-1">
          Type: {{ getFieldTypeLabel(selectedFieldType) }}
          <button type="button" class="btn-close btn-close-white ms-1" style="font-size: 0.6rem;" (click)="selectedFieldType = ''; onFilterChange()"></button>
        </span>
        
        <span *ngIf="selectedSurfaceType" class="badge bg-success me-1 mb-1">
          Surface: {{ getSurfaceTypeLabel(selectedSurfaceType) }}
          <button type="button" class="btn-close btn-close-white ms-1" style="font-size: 0.6rem;" (click)="selectedSurfaceType = ''; onFilterChange()"></button>
        </span>
        
        <span *ngIf="selectedLocation" class="badge bg-warning me-1 mb-1">
          Location: {{ selectedLocation }}
          <button type="button" class="btn-close btn-close-white ms-1" style="font-size: 0.6rem;" (click)="selectedLocation = ''; onFilterChange()"></button>
        </span>
        
        <span *ngIf="selectedStatus" class="badge bg-danger me-1 mb-1">
          Status: {{ selectedStatus | titlecase }}
          <button type="button" class="btn-close btn-close-white ms-1" style="font-size: 0.6rem;" (click)="selectedStatus = ''; onFilterChange()"></button>
        </span>
      </div>
    </div>
  </div>
</div>

<!-- Results Summary -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <span class="text-muted">
      Showing {{ fields.length }} of {{ stats?.total_fields || 0 }} fields
      <span *ngIf="hasActiveFilters()"> (filtered)</span>
    </span>
  </div>
  
  <!-- Sort Options -->
  <div class="d-flex align-items-center">
    <label class="form-label me-2 mb-0">Sort by:</label>
    <select class="form-select form-select-sm me-2" style="width: auto;" [(ngModel)]="sortBy" (change)="onFilterChange()">
      <option value="name">Name</option>
      <option value="field_type">Type</option>
      <option value="capacity">Capacity</option>
      <option value="location">Location</option>
      <option value="hourly_rate">Rate</option>
      <option value="created_at">Date Added</option>
    </select>
    
    <button 
      type="button"
      class="btn btn-outline-secondary btn-sm"
      (click)="toggleSortOrder()"
    >
      <i [class]="'fas fa-sort-' + (sortOrder === 'asc' ? 'up' : 'down')"></i>
    </button>
  </div>
</div>
      <!-- Success/Error Messages -->
      <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>{{ successMessage }}
        <button type="button" class="btn-close" (click)="successMessage = ''"></button>
      </div>

      <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
        <button type="button" class="btn-close" (click)="error = ''"></button>
      </div>

      <!-- Loading -->
      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-success" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading fields...</p>
      </div>

      <!-- Cards View -->
       
      <div *ngIf="viewMode === 'cards' && !isLoading">
        <div class="row" *ngIf="fields.length > 0">
          <div class="col-md-6 col-lg-4 mb-4" *ngFor="let field of fields">
            <div class="card h-100 shadow-sm border-0 field-card">
            <div class="card-header" [class]="'bg-' + getAvailabilityStatusColor(field.availability_status || 'available') + ' text-white'">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-0 fw-bold">
                    <i [class]="getFieldTypeIcon(field.field_type) + ' me-2'"></i>
                    {{ field.name }}
                  </h6>
                  <small>{{ getFieldTypeLabel(field.field_type) }}</small>
                </div>
                <div class="d-flex align-items-center">
                  <span class="availability-indicator me-2" [class]="field.availability_status || 'available'">
                    <i [class]="getAvailabilityStatusIcon(field.availability_status || 'available')"></i>
                    {{ (field.availability_status || 'available') | titlecase }}
                  </span>
                  <div class="dropdown">
                    <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#" (click)="openViewModal(field); $event.preventDefault()">
                        <i class="fas fa-eye me-2"></i>View Details
                      </a></li>
                      <li><a class="dropdown-item" href="#" (click)="openBookingModal(field); $event.preventDefault()">
                        <i class="fas fa-calendar-plus me-2"></i>Book Field
                      </a></li>
                      <li><a class="dropdown-item" href="#" (click)="openEditModal(field); $event.preventDefault()">
                        <i class="fas fa-edit me-2"></i>Edit Field
                      </a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item text-danger" href="#" (click)="openDeleteModal(field); $event.preventDefault()">
                        <i class="fas fa-trash me-2"></i>Delete Field
                      </a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
              <div class="card-body">
                <!-- Field Details -->
                <div class="mb-3">
                  <div class="d-flex align-items-center mb-2">
                    <i class="fas fa-layer-group text-primary me-2"></i>
                    <strong>{{ getSurfaceTypeLabel(field.surface_type) }}</strong>
                  </div>
                  <div class="d-flex align-items-center mb-2" *ngIf="field.dimensions">
                    <i class="fas fa-ruler-combined text-success me-2"></i>
                    <span>{{ field.dimensions }}</span>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="fas fa-users text-info me-2"></i>
                    <span>Capacity: {{ field.capacity }} players</span>
                  </div>
                </div>

                <!-- Location -->
                <div class="mb-3" *ngIf="field.location">
                  <small class="text-muted">Location:</small><br>
                  <span class="badge bg-secondary">
                    <i class="fas fa-map-marker-alt me-1"></i>{{ field.location }}
                  </span>
                </div>

                <!-- Description -->
                <div class="mb-3" *ngIf="field.description">
                  <small class="text-muted">Description:</small>
                  <p class="small mb-0">{{ field.description | slice:0:100 }}{{ (field.description?.length || 0) > 100 ? '...' : '' }}</p>
                </div>

                <!-- Features -->
                <div class="mb-3">
                  <small class="text-muted">Features:</small><br>
                  <span *ngIf="field.is_indoor" class="badge bg-info me-1">
                    <i class="fas fa-home me-1"></i>Indoor
                  </span>
                  <span *ngIf="field.has_lighting" class="badge bg-warning me-1">
                    <i class="fas fa-lightbulb me-1"></i>Lighting
                  </span>
                  <span *ngIf="field.has_parking" class="badge bg-primary me-1">
                    <i class="fas fa-parking me-1"></i>Parking
                  </span>
                  <span *ngIf="field.has_changing_rooms" class="badge bg-success me-1">
                    <i class="fas fa-door-open me-1"></i>Changing Rooms
                  </span>
                </div>

                <!-- Status and Stats -->
                <div class="row g-2 text-center">
                  <div class="col-6">
                    <div class="fw-bold" [class]="'text-' + getFieldStatusColor(field)">
                      <i [class]="getFieldStatusIcon(field)" class="me-1"></i>
                      {{ field.availability_status || 'Available' | titlecase }}
                    </div>
                    <small class="text-muted">Status</small>
                  </div>
                  <div class="col-6">
                    <div class="fw-bold text-secondary">{{ field.total_bookings || 0 }}</div>
                    <small class="text-muted">Bookings</small>
                  </div>
                </div>
              </div>
              
             <!-- Update the card footer buttons in the cards view -->
            <div class="card-footer bg-transparent">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span *ngIf="field.hourly_rate && field.hourly_rate > 0" class="badge bg-warning">
                    ${{ field.hourly_rate }}/hour
                  </span>
                  <span *ngIf="!field.hourly_rate || field.hourly_rate === 0" class="badge bg-success">
                    Free
                  </span>
                </div>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" (click)="openViewModal(field)" title="View Details">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button 
                    class="btn btn-outline-success" 
                    (click)="openBookingModal(field)" 
                    title="Book Field"
                    [disabled]="field.availability_status === 'maintenance'"
                  >
                    <i class="fas fa-calendar-plus"></i>
                  </button>
                  <button class="btn btn-outline-secondary" (click)="openEditModal(field)" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>

        <!-- No Fields Message -->
        <div *ngIf="fields.length === 0" class="text-center py-5">
          <i class="fas fa-map-marked-alt fa-5x text-muted mb-3"></i>
          <h5 class="text-muted">No fields found</h5>
          <p class="text-muted">Start by adding your first field to the system!</p>
          <button type="button" class="btn btn-success" (click)="openAddFieldModal()">
            <i class="fas fa-plus me-2"></i>Add Your First Field
          </button>
        </div>
      </div>

      <!-- List View -->
      <div *ngIf="viewMode === 'list' && !isLoading" class="card">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Field Name</th>
                  <th>Type</th>
                  <th>Surface</th>
                  <th>Capacity</th>
                  <th>Location</th>
                  <th>Features</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let field of fields">
                  <td>
                    <div>
                      <div class="fw-bold">{{ field.name }}</div>
                      <small class="text-muted" *ngIf="field.description">
                        {{ field.description | slice:0:50 }}{{ (field.description?.length || 0) > 50 ? '...' : '' }}
                      </small>
                    </div>
                  </td>
                  <td>
                    <span class="badge bg-primary">{{ getFieldTypeLabel(field.field_type) }}</span>
                  </td>
                  <td>{{ getSurfaceTypeLabel(field.surface_type) }}</td>
                  <td class="text-center">{{ field.capacity }}</td>
                  <td>
                    <span *ngIf="field.location" class="badge bg-secondary">{{ field.location }}</span>
                    <span *ngIf="!field.location" class="text-muted">-</span>
                  </td>
                  <td>
                    <span *ngIf="field.is_indoor" class="badge bg-info me-1">Indoor</span>
                    <span *ngIf="field.has_lighting" class="badge bg-warning me-1">Lighting</span>
                  </td>
                  <td>
                    <span [class]="'badge bg-' + getFieldStatusColor(field)">
                      {{ field.availability_status || 'Available' | titlecase }}
                    </span>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <button class="btn btn-outline-primary" (click)="openViewModal(field)" title="View">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn btn-outline-secondary" (click)="openEditModal(field)" title="Edit">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-outline-success" title="Book">
                        <i class="fas fa-calendar-plus"></i>
                      </button>
                      <button class="btn btn-outline-danger" (click)="openDeleteModal(field)" title="Delete">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Grid View -->
      <div *ngIf="viewMode === 'grid' && !isLoading">
        <div class="row" *ngIf="fields.length > 0">
          <div class="col-md-3 col-sm-6 mb-3" *ngFor="let field of fields">
            <div class="card border-0 shadow-sm text-center h-100">
              <div class="card-body">
                <div class="mb-3">
                  <i [class]="getFieldTypeIcon(field.field_type) + ' fa-3x text-' + getFieldStatusColor(field)"></i>
                </div>
                <h6 class="card-title">{{ field.name }}</h6>
                <p class="card-text small text-muted">{{ getFieldTypeLabel(field.field_type) }}</p>
                <div class="mb-2">
                  <span class="badge bg-secondary">{{ field.capacity }} players</span>
                </div>
                <div class="btn-group w-100">
                  <button class="btn btn-outline-primary btn-sm" (click)="openViewModal(field)">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-outline-success btn-sm">
                    <i class="fas fa-calendar-plus"></i>
                  </button>
                  <button class="btn btn-outline-secondary btn-sm" (click)="openEditModal(field)">
                    <i class="fas fa-edit"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
<!-- Add Field Modal -->
<div class="modal" [style.display]="showAddFieldModal ? 'block' : 'none'" [class.show]="showAddFieldModal">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <form [formGroup]="fieldForm" (ngSubmit)="saveField()">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">
            <i class="fas fa-plus me-2"></i>Add New Field
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeAddFieldModal()"></button>
        </div>
        <div class="modal-body">
          <div class="row g-4">
            <!-- Basic Information -->
            <div class="col-12">
              <h6 class="text-success">
                <i class="fas fa-info-circle me-2"></i>Basic Information
              </h6>
            </div>
            
            <div class="col-md-6">
              <label for="fieldName" class="form-label">Field Name *</label>
              <input 
                type="text" 
                class="form-control"
                id="fieldName"
                formControlName="name"
                [class.is-invalid]="isFieldInvalid('name')"
                placeholder="e.g., Main Stadium Field"
              >
              <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
                Field name is required (minimum 2 characters)
              </div>
            </div>

            <div class="col-md-6">
              <label for="fieldType" class="form-label">Field Type *</label>
              <select 
                class="form-select" 
                id="fieldType"
                formControlName="field_type"
                [class.is-invalid]="isFieldInvalid('field_type')"
              >
                <option *ngFor="let type of fieldTypes" [value]="type.value">
                  {{ type.label }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('field_type')">
                Field type is required
              </div>
            </div>

            <div class="col-12">
              <label for="fieldDescription" class="form-label">Description</label>
              <textarea 
                class="form-control" 
                id="fieldDescription"
                formControlName="description"
                rows="2"
                placeholder="Brief description of the field..."
              ></textarea>
            </div>

            <!-- Field Specifications -->
            <div class="col-12">
              <h6 class="text-success">
                <i class="fas fa-ruler-combined me-2"></i>Field Specifications
              </h6>
            </div>

            <div class="col-md-4">
              <label for="surfaceType" class="form-label">Surface Type *</label>
              <select 
                class="form-select" 
                id="surfaceType"
                formControlName="surface_type"
              >
                <option *ngFor="let surface of surfaceTypes" [value]="surface.value">
                  {{ surface.label }}
                </option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="fieldDimensions" class="form-label">Dimensions</label>
              <input 
                type="text" 
                class="form-control" 
                id="fieldDimensions"
                formControlName="dimensions"
                placeholder="e.g., 105m x 68m"
              >
            </div>

            <div class="col-md-4">
              <label for="fieldCapacity" class="form-label">Player Capacity *</label>
              <input 
                type="number" 
                class="form-control" 
                id="fieldCapacity"
                formControlName="capacity"
                [class.is-invalid]="isFieldInvalid('capacity')"
                min="1"
                max="100"
                placeholder="22"
              >
              <div class="invalid-feedback" *ngIf="isFieldInvalid('capacity')">
                Capacity must be between 1 and 100 players
              </div>
            </div>

            <!-- Location -->
            <div class="col-12">
              <h6 class="text-success">
                <i class="fas fa-map-marker-alt me-2"></i>Location
              </h6>
            </div>

            <div class="col-md-6">
              <label for="fieldLocation" class="form-label">Campus/Area</label>
              <input 
                type="text" 
                class="form-control" 
                id="fieldLocation"
                formControlName="location"
                placeholder="e.g., North Campus, East Campus"
              >
            </div>

            <div class="col-md-6">
              <label for="fieldAddress" class="form-label">Full Address</label>
              <input 
                type="text" 
                class="form-control" 
                id="fieldAddress"
                formControlName="address"
                placeholder="123 Academy Drive, Sports Complex"
              >
            </div>

            <!-- Features and Facilities -->
            <div class="col-12">
              <h6 class="text-success">
                <i class="fas fa-cogs me-2"></i>Features & Facilities
              </h6>
            </div>

            <div class="col-md-6">
              <label for="fieldFacilities" class="form-label">Available Facilities</label>
              <textarea 
                class="form-control" 
                id="fieldFacilities"
                formControlName="facilities"
                rows="3"
                placeholder="Spectator stands, dugouts, scoreboard, etc."
              ></textarea>
            </div>

            <div class="col-md-6">
              <label for="fieldEquipment" class="form-label">Available Equipment</label>
              <textarea 
                class="form-control" 
                id="fieldEquipment"
                formControlName="equipment_available"
                rows="3"
                placeholder="Goals, corner flags, nets, training cones, etc."
              ></textarea>
            </div>

            <!-- Features Checkboxes -->
            <div class="col-12">
              <div class="row">
                <div class="col-md-3">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="isIndoor"
                      formControlName="is_indoor"
                    >
                    <label class="form-check-label" for="isIndoor">
                      <i class="fas fa-home me-1"></i>Indoor Field
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="hasLighting"
                      formControlName="has_lighting"
                    >
                    <label class="form-check-label" for="hasLighting">
                      <i class="fas fa-lightbulb me-1"></i>Floodlights
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="hasParking"
                      formControlName="has_parking"
                    >
                    <label class="form-check-label" for="hasParking">
                      <i class="fas fa-parking me-1"></i>Parking Available
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="hasChangingRooms"
                      formControlName="has_changing_rooms"
                    >
                    <label class="form-check-label" for="hasChangingRooms">
                      <i class="fas fa-door-open me-1"></i>Changing Rooms
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Additional Information -->
            <div class="col-12">
              <h6 class="text-success">
                <i class="fas fa-dollar-sign me-2"></i>Additional Information
              </h6>
            </div>

            <div class="col-md-6">
              <label for="hourlyRate" class="form-label">Hourly Rate ($)</label>
              <input 
                type="number" 
                class="form-control" 
                id="hourlyRate"
                formControlName="hourly_rate"
                step="0.01"
                min="0"
                placeholder="0.00"
              >
              <small class="form-text text-muted">Leave 0.00 for free fields</small>
            </div>

            <div class="col-md-6">
              <label for="maintenanceNotes" class="form-label">Maintenance Notes</label>
              <textarea 
                class="form-control" 
                id="maintenanceNotes"
                formControlName="maintenance_notes"
                rows="2"
                placeholder="Any special maintenance requirements..."
              ></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeAddFieldModal()">
            <i class="fas fa-times me-2"></i>Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-success"
            [disabled]="fieldForm.invalid || isSubmitting"
          >
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            <i *ngIf="!isSubmitting" class="fas fa-plus me-2"></i>
            Add Field
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Field Modal -->
<div class="modal" [style.display]="showEditModal ? 'block' : 'none'" [class.show]="showEditModal">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <form [formGroup]="fieldForm" (ngSubmit)="saveField()">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">
            <i class="fas fa-edit me-2"></i>Edit Field - {{ editingField?.name }}
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeEditModal()"></button>
        </div>
        <div class="modal-body">
          <!-- Same form structure as Add Field Modal -->
          <div class="row g-4">
            <!-- Basic Information -->
            <div class="col-12">
              <h6 class="text-primary">
                <i class="fas fa-info-circle me-2"></i>Basic Information
              </h6>
            </div>
            
            <div class="col-md-6">
              <label for="editFieldName" class="form-label">Field Name *</label>
              <input 
                type="text" 
                class="form-control"
                id="editFieldName"
                formControlName="name"
                [class.is-invalid]="isFieldInvalid('name')"
              >
            </div>

            <div class="col-md-6">
              <label for="editFieldType" class="form-label">Field Type *</label>
              <select 
                class="form-select" 
                id="editFieldType"
                formControlName="field_type"
              >
                <option *ngFor="let type of fieldTypes" [value]="type.value">
                  {{ type.label }}
                </option>
              </select>
            </div>

            <div class="col-12">
              <label for="editFieldDescription" class="form-label">Description</label>
              <textarea 
                class="form-control" 
                id="editFieldDescription"
                formControlName="description"
                rows="2"
              ></textarea>
            </div>

            <!-- Field Specifications -->
            <div class="col-12">
              <h6 class="text-primary">
                <i class="fas fa-ruler-combined me-2"></i>Field Specifications
              </h6>
            </div>

            <div class="col-md-4">
              <label for="editSurfaceType" class="form-label">Surface Type *</label>
              <select 
                class="form-select" 
                id="editSurfaceType"
                formControlName="surface_type"
              >
                <option *ngFor="let surface of surfaceTypes" [value]="surface.value">
                  {{ surface.label }}
                </option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="editFieldDimensions" class="form-label">Dimensions</label>
              <input 
                type="text" 
                class="form-control" 
                id="editFieldDimensions"
                formControlName="dimensions"
              >
            </div>

            <div class="col-md-4">
              <label for="editFieldCapacity" class="form-label">Player Capacity *</label>
              <input 
                type="number" 
                class="form-control" 
                id="editFieldCapacity"
                formControlName="capacity"
                min="1"
                max="100"
              >
            </div>

            <!-- Features Checkboxes -->
            <div class="col-12">
              <h6 class="text-primary">
                <i class="fas fa-cogs me-2"></i>Features
              </h6>
              <div class="row">
                <div class="col-md-3">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="editIsIndoor"
                      formControlName="is_indoor"
                    >
                    <label class="form-check-label" for="editIsIndoor">
                      <i class="fas fa-home me-1"></i>Indoor Field
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="editHasLighting"
                      formControlName="has_lighting"
                    >
                    <label class="form-check-label" for="editHasLighting">
                      <i class="fas fa-lightbulb me-1"></i>Floodlights
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="editHasParking"
                      formControlName="has_parking"
                    >
                    <label class="form-check-label" for="editHasParking">
                      <i class="fas fa-parking me-1"></i>Parking Available
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      id="editHasChangingRooms"
                      formControlName="has_changing_rooms"
                    >
                    <label class="form-check-label" for="editHasChangingRooms">
                      <i class="fas fa-door-open me-1"></i>Changing Rooms
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeEditModal()">
            <i class="fas fa-times me-2"></i>Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="fieldForm.invalid || isSubmitting"
          >
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            <i *ngIf="!isSubmitting" class="fas fa-save me-2"></i>
            Update Field
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- View Field Modal -->
<div class="modal" [style.display]="showViewModal ? 'block' : 'none'" [class.show]="showViewModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title">
          <i [class]="getFieldTypeIcon(viewingField?.field_type || 'full_size') + ' me-2'"></i>
          {{ viewingField?.name }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeViewModal()"></button>
      </div>
      <div class="modal-body" *ngIf="viewingField">
        <div class="row g-4">
          <!-- Field Overview -->
          <div class="col-12">
            <div class="card border-0 bg-light">
              <div class="card-body">
                <div class="row text-center">
                  <div class="col-md-3">
                    <div class="h4 text-primary mb-0">{{ getFieldTypeLabel(viewingField.field_type) }}</div>
                    <small class="text-muted">Field Type</small>
                  </div>
                  <div class="col-md-3">
                    <div class="h4 text-success mb-0">{{ getSurfaceTypeLabel(viewingField.surface_type) }}</div>
                    <small class="text-muted">Surface</small>
                  </div>
                  <div class="col-md-3">
                    <div class="h4 text-info mb-0">{{ viewingField.capacity }}</div>
                    <small class="text-muted">Capacity</small>
                  </div>
                  <div class="col-md-3">
                    <div class="h4" [class]="'text-' + getFieldStatusColor(viewingField)">
                      {{ viewingField.availability_status || 'Available' | titlecase }}
                    </div>
                    <small class="text-muted">Status</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Field Details -->
          <div class="col-md-6">
            <h6 class="text-info">
              <i class="fas fa-info-circle me-2"></i>Field Information
            </h6>
            <table class="table table-sm">
              <tr *ngIf="viewingField.dimensions">
                <td><strong>Dimensions:</strong></td>
                <td>{{ viewingField.dimensions }}</td>
              </tr>
              <tr *ngIf="viewingField.location">
                <td><strong>Location:</strong></td>
                <td>{{ viewingField.location }}</td>
              </tr>
              <tr *ngIf="viewingField.address">
                <td><strong>Address:</strong></td>
                <td>{{ viewingField.address }}</td>
              </tr>
              <tr *ngIf="viewingField.hourly_rate">
                <td><strong>Hourly Rate:</strong></td>
                <td>${{ viewingField.hourly_rate }}/hour</td>
              </tr>
            </table>
          </div>

          <!-- Features -->
          <div class="col-md-6">
            <h6 class="text-info">
              <i class="fas fa-star me-2"></i>Features
            </h6>
            <div class="d-flex flex-wrap">
              <span *ngIf="viewingField.is_indoor" class="badge bg-info me-2 mb-1">
                <i class="fas fa-home me-1"></i>Indoor
              </span>
              <span *ngIf="viewingField.has_lighting" class="badge bg-warning me-2 mb-1">
                <i class="fas fa-lightbulb me-1"></i>Lighting
              </span>
              <span *ngIf="viewingField.has_parking" class="badge bg-primary me-2 mb-1">
                <i class="fas fa-parking me-1"></i>Parking
              </span>
              <span *ngIf="viewingField.has_changing_rooms" class="badge bg-success me-2 mb-1">
                <i class="fas fa-door-open me-1"></i>Changing Rooms
              </span>
            </div>
          </div>

          <!-- Description -->
          <div class="col-12" *ngIf="viewingField.description">
            <h6 class="text-info">
              <i class="fas fa-align-left me-2"></i>Description
            </h6>
            <p class="mb-0">{{ viewingField.description }}</p>
          </div>

          <!-- Facilities -->
          <div class="col-md-6" *ngIf="viewingField.facilities">
            <h6 class="text-info">
              <i class="fas fa-building me-2"></i>Facilities
            </h6>
            <p class="mb-0">{{ viewingField.facilities }}</p>
          </div>

          <!-- Equipment -->
          <div class="col-md-6" *ngIf="viewingField.equipment_available">
            <h6 class="text-info">
              <i class="fas fa-tools me-2"></i>Available Equipment
            </h6>
            <p class="mb-0">{{ viewingField.equipment_available }}</p>
          </div>

          <!-- Maintenance Notes -->
          <div class="col-12" *ngIf="viewingField.maintenance_notes">
            <h6 class="text-warning">
              <i class="fas fa-wrench me-2"></i>Maintenance Notes
            </h6>
            <div class="alert alert-warning">
              {{ viewingField.maintenance_notes }}
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeViewModal()">
          <i class="fas fa-times me-2"></i>Close
        </button>
        <button type="button" class="btn btn-success">
          <i class="fas fa-calendar-plus me-2"></i>Book Field
        </button>
        <button type="button" class="btn btn-primary" (click)="openEditModal(viewingField!); closeViewModal()">
          <i class="fas fa-edit me-2"></i>Edit Field
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" [style.display]="showDeleteModal ? 'block' : 'none'" [class.show]="showDeleteModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeDeleteModal()"></button>
      </div>
      <div class="modal-body" *ngIf="fieldToDelete">
        <div class="text-center">
          <i class="fas fa-trash-alt fa-4x text-danger mb-3"></i>
          <h5>Are you sure you want to delete this field?</h5>
          <p class="mb-0">
            <strong>{{ fieldToDelete.name }}</strong><br>
            <small class="text-muted">This action cannot be undone</small>
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">
          <i class="fas fa-times me-2"></i>Cancel
        </button>
        <button type="button" class="btn btn-danger" (click)="deleteField()">
          <i class="fas fa-trash me-2"></i>Delete Field
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Field Booking Modal -->
<div class="modal" [style.display]="showBookingModal ? 'block' : 'none'" [class.show]="showBookingModal">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">
          <i class="fas fa-calendar-plus me-2"></i>
          Book Field - {{ selectedFieldForBooking?.name }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeBookingModal()"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <!-- Booking Form -->
          <div class="col-md-8">
            <form [formGroup]="bookingForm" (ngSubmit)="createBooking()">
              <div class="row g-3">
                <!-- Booking Details -->
                <div class="col-12">
                  <h6 class="text-success">
                    <i class="fas fa-info-circle me-2"></i>Booking Details
                  </h6>
                </div>

                <div class="col-md-6">
                  <label for="bookingTitle" class="form-label">Booking Title *</label>
                  <input 
                    type="text" 
                    class="form-control"
                    id="bookingTitle"
                    formControlName="booking_title"
                    [class.is-invalid]="isFieldInvalid('booking_title')"
                    placeholder="e.g., Morning Training Session"
                  >
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('booking_title')">
                    Booking title is required (minimum 3 characters)
                  </div>
                </div>

                <div class="col-md-6">
                  <label for="bookingType" class="form-label">Booking Type *</label>
                  <select 
                    class="form-select" 
                    id="bookingType"
                    formControlName="booking_type"
                  >
                    <option *ngFor="let type of bookingTypes" [value]="type.value">
                      {{ type.label }}
                    </option>
                  </select>
                </div>

                <!-- Date and Time -->
                <div class="col-12">
                  <h6 class="text-success">
                    <i class="fas fa-clock me-2"></i>Schedule
                  </h6>
                </div>

                <div class="col-md-4">
                  <label for="bookingDate" class="form-label">Date *</label>
                 <input 
  type="date" 
  class="form-control" 
  id="bookingDate"
  formControlName="booking_date"
  [class.is-invalid]="isFieldInvalid('booking_date')"
  [min]="minDate"
>

<!-- Also update the recurring end date field -->
<!-- <input 
  type="date" 
  class="form-control" 
  id="recurringEndDate"
  formControlName="recurring_end_date"
  [min]="bookingForm.get('booking_date')?.value || minDate"
> -->
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('booking_date')">
                    Date is required
                  </div>
                </div>

                <div class="col-md-4">
                  <label for="startTime" class="form-label">Start Time *</label>
                  <input 
                    type="time" 
                    class="form-control" 
                    id="startTime"
                    formControlName="start_time"
                    [class.is-invalid]="isFieldInvalid('start_time')"
                  >
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('start_time')">
                    Start time is required
                  </div>
                </div>

                <div class="col-md-4">
                  <label for="endTime" class="form-label">End Time *</label>
                  <input 
                    type="time" 
                    class="form-control" 
                    id="endTime"
                    formControlName="end_time"
                    [class.is-invalid]="isFieldInvalid('end_time')"
                  >
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('end_time')">
                    End time is required
                  </div>
                </div>

                <!-- Availability Check -->
                <div class="col-12" *ngIf="availabilityCheck">
                  <div [class]="'alert alert-' + (availabilityCheck.is_available ? 'success' : 'warning')">
                    <div class="d-flex align-items-center">
                      <i [class]="'fas ' + (availabilityCheck.is_available ? 'fa-check-circle' : 'fa-exclamation-triangle') + ' me-2'"></i>
                      <strong>
                        {{ availabilityCheck.is_available ? 'Time slot is available!' : 'Time slot conflict detected' }}
                      </strong>
                    </div>
                    
                    <!-- Conflicts -->
                    <div *ngIf="!availabilityCheck.is_available && availabilityCheck.conflicts?.length > 0" class="mt-2">
                      <small>Conflicts with:</small>
                      <ul class="mb-0 mt-1">
                        <li *ngFor="let conflict of availabilityCheck.conflicts">
                          <strong>{{ conflict.booking_title }}</strong> 
                          ({{ formatTimeSlot(conflict.start_time, conflict.end_time) }})
                        </li>
                      </ul>
                    </div>

                    <!-- Alternative Slots -->
                    <div *ngIf="!availabilityCheck.is_available && availabilityCheck.alternative_slots?.length > 0" class="mt-3">
                      <small>Suggested alternative times:</small>
                      <div class="mt-2">
                        <button 
                          *ngFor="let slot of availabilityCheck.alternative_slots" 
                          type="button"
                          class="btn btn-outline-success btn-sm me-2 mb-1"
                          (click)="selectAlternativeSlot(slot)"
                        >
                          {{ formatTimeSlot(slot.start_time, slot.end_time) }}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Loading Availability -->
                <div class="col-12" *ngIf="isCheckingAvailability">
                  <div class="alert alert-info">
                    <i class="fas fa-spinner fa-spin me-2"></i>
                    Checking availability...
                  </div>
                </div>

                <!-- Notes -->
                <div class="col-12">
                  <label for="bookingNotes" class="form-label">Notes</label>
                  <textarea 
                    class="form-control" 
                    id="bookingNotes"
                    formControlName="notes"
                    rows="3"
                    placeholder="Additional notes or special requirements..."
                  ></textarea>
                </div>

                <!-- Recurring Options -->
                <div class="col-12">
                  <h6 class="text-success">
                    <i class="fas fa-repeat me-2"></i>Recurring Booking (Optional)
                  </h6>
                </div>

                <div class="col-md-6">
                  <label for="recurringType" class="form-label">Repeat</label>
                  <select class="form-select" id="recurringType" formControlName="recurring_type">
                    <option value="none">No Repeat</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                  </select>
                </div>

                <div class="col-md-6" *ngIf="bookingForm.get('recurring_type')?.value !== 'none'">
                  <label for="recurringEndDate" class="form-label">End Date</label>
                  <input 
                    type="date" 
                    class="form-control" 
                    id="recurringEndDate"
                    formControlName="recurring_end_date"
                    [min]="bookingForm.get('booking_date')?.value"
                  >
                </div>
              </div>

              <!-- Form Actions -->
              <div class="d-flex justify-content-end mt-4">
                <button type="button" class="btn btn-secondary me-2" (click)="closeBookingModal()">
                  <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button 
                  type="submit" 
                  class="btn btn-success"
                  [disabled]="bookingForm.invalid || isSubmitting || (availabilityCheck && !availabilityCheck.is_available)"
                >
                  <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
                  <i *ngIf="!isSubmitting" class="fas fa-calendar-plus me-2"></i>
                  Book Field
                </button>
              </div>
            </form>
          </div>

          <!-- Field Info & Existing Bookings -->
          <div class="col-md-4">
            <!-- Field Information -->
            <div class="card border-0 bg-light mb-4" *ngIf="selectedFieldForBooking">
              <div class="card-body">
                <h6 class="text-info">
                  <i class="fas fa-map-marked-alt me-2"></i>Field Information
                </h6>
                <table class="table table-sm table-borderless">
                  <tr>
                    <td><strong>Type:</strong></td>
                    <td>{{ getFieldTypeLabel(selectedFieldForBooking.field_type) }}</td>
                  </tr>
                  <tr>
                    <td><strong>Surface:</strong></td>
                    <td>{{ getSurfaceTypeLabel(selectedFieldForBooking.surface_type) }}</td>
                  </tr>
                  <tr>
                    <td><strong>Capacity:</strong></td>
                    <td>{{ selectedFieldForBooking.capacity }} players</td>
                  </tr>
                  <tr *ngIf="selectedFieldForBooking.hourly_rate">
                    <td><strong>Rate:</strong></td>
                    <td>${{ selectedFieldForBooking.hourly_rate }}/hour</td>
                  </tr>
                </table>
              </div>
            </div>

            <!-- Upcoming Bookings -->
            <div class="card border-0 bg-light">
              <div class="card-header bg-transparent">
                <h6 class="mb-0 text-info">
                  <i class="fas fa-calendar me-2"></i>Upcoming Bookings
                </h6>
              </div>
              <div class="card-body">
                <div *ngIf="fieldBookings.length === 0" class="text-center text-muted">
                  <i class="fas fa-calendar-check fa-2x mb-2"></i>
                  <p class="mb-0">No upcoming bookings</p>
                </div>
                
                <div *ngFor="let booking of fieldBookings" class="border-start border-3 ps-3 mb-3" 
                     [class]="'border-' + getBookingTypeColor(booking.booking_type)">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <div class="fw-bold">{{ booking.booking_title }}</div>
                      <small class="text-muted">
                        <i [class]="getBookingTypeIcon(booking.booking_type)" class="me-1"></i>
                        {{ getBookingTypeLabel(booking.booking_type) }}
                      </small>
                    </div>
                    <span [class]="'badge bg-' + getBookingTypeColor(booking.booking_type)">
                      {{ booking.status | titlecase }}
                    </span>
                  </div>
                  <div class="small text-muted mt-1">
                    <i class="fas fa-calendar me-1"></i>{{ booking.booking_date | date:'shortDate' }}
                    <br>
                    <i class="fas fa-clock me-1"></i>{{ formatTimeSlot(booking.start_time, booking.end_time) }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Booking Modal Backdrop -->
<div *ngIf="showBookingModal" class="modal-backdrop fade show"></div>
<!-- Modal Backdrops -->
<div *ngIf="showAddFieldModal || showEditModal || showViewModal || showDeleteModal" class="modal-backdrop fade show"></div>